<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Limpeza de Dados | Ferramenta Profissional</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <i class="fas fa-broom"></i>
        <h1>DataClean Pro</h1>
      </div>
      <p class="subtitle">Ferramenta profissional de limpeza e padronização de dados</p>
    </header>

    <main class="main-content">
      <form id="form-processamento" method="POST" enctype="multipart/form-data" class="upload-form">
        <div class="form-group file-upload">
          <label for="file-upload" class="upload-label">
            <i class="fas fa-file-excel"></i>
            <span id="file-name">Selecione um arquivo Excel (.xlsx)</span>
            <input type="file" id="file-upload" name="file" accept=".xlsx,.xls" required>
          </label>
        </div>

        <div class="form-group options-group">
          <h3><i class="fas fa-cog"></i> Opções de Processamento</h3>
          
          <div class="option-item">
            <input type="checkbox" id="minusculo" name="minusculo" checked>
            <label for="minusculo">
              <i class="fas fa-font"></i> Converter texto para minúsculo
            </label>
          </div>
          
          <div class="option-item">
            <input type="checkbox" id="remover_especiais" name="remover_especiais" checked>
            <label for="remover_especiais">
              <i class="fas fa-language"></i> Remover acentos e caracteres especiais
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="caracteres">
            <i class="fas fa-filter"></i> Caracteres especiais para remover (regex)
          </label>
          <input type="text" id="caracteres" name="caracteres" 
                 value="[.,;:!?@#$%^&*_+=|\\/<>\[\]{}()\"\'`~]" 
                 placeholder="Insira a expressão regular para filtro">
          <small class="hint">Padrão regex para identificar caracteres a serem removidos</small>
        </div>

        <div class="form-footer">
          <div class="file-info">
            <i class="fas fa-info-circle"></i>
            <span>Tamanho máximo: <strong>{{ max_size_mb }} MB</strong></span>
          </div>
          <button type="submit" class="submit-btn">
            <i class="fas fa-magic"></i> Processar e Baixar
          </button>
        </div>
      </form>

      <div id="progresso-container" class="progress-container">
        <div class="progress-header">
          <h3><i class="fas fa-sync-alt fa-spin"></i> Processando seu arquivo</h3>
          <span id="progresso-texto">0%</span>
        </div>
        <div class="progress-bar">
          <div id="progresso-barra" class="progress-fill"></div>
        </div>
        <div class="progress-details">
          <p id="status-message">Preparando para iniciar o processamento...</p>
          <div id="file-stats" class="stats">
            <div><i class="fas fa-file"></i> <span id="file-size">-</span></div>
            <div><i class="fas fa-table"></i> <span id="row-count">-</span></div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <p>© 2023 DataClean Pro | Versão 1.0</p>
      <div class="footer-links">
        <a href="#"><i class="fas fa-question-circle"></i> Ajuda</a>
        <a href="#"><i class="fas fa-envelope"></i> Contato</a>
        <a href="#"><i class="fas fa-shield-alt"></i> Privacidade</a>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('form-processamento');
      const progressoContainer = document.getElementById('progresso-container');
      const progressoBarra = document.getElementById('progresso-barra');
      const progressoTexto = document.getElementById('progresso-texto');
      const statusMessage = document.getElementById('status-message');
      const fileUpload = document.getElementById('file-upload');
      const fileName = document.getElementById('file-name');
      const fileSize = document.getElementById('file-size');
      const rowCount = document.getElementById('row-count');

      // Esconder o container de progresso inicialmente
      progressoContainer.style.display = 'none';

      // Atualizar nome do arquivo selecionado
      fileUpload.addEventListener('change', function(e) {
        if (this.files.length) {
          fileName.textContent = this.files[0].name;
          
          // Mostrar informações do arquivo
          const size = (this.files[0].size / (1024 * 1024)).toFixed(2);
          fileSize.textContent = `${size} MB`;
          
          // Simular contagem de linhas (seria substituído por cálculo real em produção)
          const estimatedRows = Math.floor(Math.random() * 5000) + 1000;
          rowCount.textContent = `~${estimatedRows} linhas`;
        }
      });

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Mostrar container de progresso
        progressoContainer.style.display = 'block';
        progressoBarra.style.width = '0%';
        progressoTexto.textContent = '0%';
        statusMessage.textContent = 'Iniciando processamento...';
        
        // Simular progresso (substituir por progresso real em produção)
        let progresso = 0;
        const intervalo = setInterval(() => {
          progresso += 1;
          
          if (progresso >= 100) {
            clearInterval(intervalo);
            progressoTexto.textContent = '100%';
            progressoBarra.style.width = '100%';
            statusMessage.innerHTML = '<i class="fas fa-check-circle success"></i> Processamento concluído com sucesso!';
            
            // Submeter o formulário após pequeno delay para mostrar conclusão
            setTimeout(() => {
              form.submit();
            }, 1000);
          } else {
            progressoBarra.style.width = progresso + '%';
            progressoTexto.textContent = progresso + '%';
            
            // Atualizar mensagens de status conforme o progresso
            if (progresso < 30) {
              statusMessage.textContent = 'Lendo arquivo e validando dados...';
            } else if (progresso < 60) {
              statusMessage.textContent = 'Aplicando transformações nos dados...';
            } else if (progresso < 90) {
              statusMessage.textContent = 'Otimizando e preparando para download...';
            }
          }
        }, 50);
      });
    });
  </script>
</body>
</html>
