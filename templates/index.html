<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DataClean Pro | Ferramenta Profissional de Limpeza de Dados</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <i class="fas fa-broom"></i>
        <h1>DataClean Pro</h1>
      </div>
      <p class="subtitle">Ferramenta profissional de limpeza e padronização de dados</p>
    </header>

    <main class="main-content">
      <form id="form-processamento" method="POST" enctype="multipart/form-data" class="upload-form">
        <div class="form-group">
          <label for="file-upload" class="upload-area" id="upload-area">
            <i class="fas fa-file-excel fa-3x"></i>
            <h3>Selecione um arquivo Excel (.xlsx)</h3>
            <p id="file-instructions">Arraste e solte seu arquivo aqui ou clique para selecionar</p>
            <span id="file-name" class="file-name-display"></span>
            <input type="file" id="file-upload" name="file" accept=".xlsx,.xls" required>
          </label>
        </div>

        <div class="options-grid">
          <div class="option-card">
            <h3><i class="fas fa-font"></i> Transformação de Texto</h3>
            
            <div class="option-item">
              <input type="checkbox" id="minusculo" name="minusculo" checked>
              <label for="minusculo">Converter texto para minúsculo</label>
            </div>
            
            <div class="option-item">
              <input type="checkbox" id="remover_especiais" name="remover_especiais" checked>
              <label for="remover_especiais">Remover acentos e caracteres especiais</label>
            </div>
          </div>

          <div class="option-card">
            <h3><i class="fas fa-filter"></i> Filtros Avançados</h3>
            
            <div class="form-group">
              <label for="caracteres">
                <i class="fas fa-code"></i> Caracteres para remover (regex)
              </label>
              <input type="text" id="caracteres" name="caracteres" 
                     value="[.,;:!?@#$%^&*_+=|\\/<>\[\]{}()\"\'`~]" 
                     placeholder="Insira a expressão regular">
              <small class="hint">Padrão regex para identificar caracteres a serem removidos</small>
            </div>
          </div>
        </div>

        <div class="file-stats" id="file-stats">
          <div class="stat-item">
            <i class="fas fa-file"></i>
            <span>Tamanho: <strong id="file-size">-</strong></span>
          </div>
          <div class="stat-item">
            <i class="fas fa-table"></i>
            <span>Linhas estimadas: <strong id="row-count">-</strong></span>
          </div>
        </div>

        <div class="form-footer">
          <div class="file-info">
            <i class="fas fa-info-circle"></i>
            <span>Tamanho máximo: <strong>{{ max_size_mb }} MB</strong></span>
          </div>
          <button type="submit" class="submit-btn">
            <i class="fas fa-magic"></i> Processar e Baixar
          </button>
        </div>
      </form>

      <div id="progresso-container" class="progress-container">
        <div class="progress-header">
          <h3><i class="fas fa-sync-alt fa-spin"></i> Processando seu arquivo</h3>
          <span id="progresso-texto">0%</span>
        </div>
        <div class="progress-bar">
          <div id="progresso-barra" class="progress-fill"></div>
        </div>
        <div class="progress-details">
          <p id="status-message">Preparando para iniciar o processamento...</p>
        </div>
      </div>
    </main>

    <footer class="footer">
      <p>© 2023 DataClean Pro | Versão 1.0</p>
      <div class="footer-links">
        <a href="#"><i class="fas fa-question-circle"></i> Ajuda</a>
        <a href="#"><i class="fas fa-envelope"></i> Contato</a>
        <a href="#"><i class="fas fa-shield-alt"></i> Privacidade</a>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('form-processamento');
      const progressoContainer = document.getElementById('progresso-container');
      const progressoBarra = document.getElementById('progresso-barra');
      const progressoTexto = document.getElementById('progresso-texto');
      const statusMessage = document.getElementById('status-message');
      const fileUpload = document.getElementById('file-upload');
      const uploadArea = document.getElementById('upload-area');
      const fileNameDisplay = document.getElementById('file-name');
      const fileInstructions = document.getElementById('file-instructions');
      const fileStats = document.getElementById('file-stats');
      const fileSize = document.getElementById('file-size');
      const rowCount = document.getElementById('row-count');

      // Esconder elementos inicialmente
      progressoContainer.style.display = 'none';
      fileStats.style.display = 'none';

      // Manipulação de drag and drop
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
          fileUpload.files = e.dataTransfer.files;
          handleFileSelection();
        }
      });

      // Atualizar quando arquivo for selecionado
      fileUpload.addEventListener('change', handleFileSelection);

      function handleFileSelection() {
        if (fileUpload.files.length) {
          const file = fileUpload.files[0];
          
          // Mostrar nome do arquivo
          fileNameDisplay.textContent = file.name;
          fileInstructions.style.display = 'none';
          fileNameDisplay.style.display = 'block';
          
          // Mostrar estatísticas
          fileStats.style.display = 'flex';
          const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
          fileSize.textContent = `${sizeMB} MB`;
          
          // Simular estimativa de linhas (em aplicação real seria calculado)
          const estimatedRows = Math.floor(Math.random() * 5000) + 1000;
          rowCount.textContent = estimatedRows.toLocaleString();
        }
      }

      // Submissão do formulário
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!fileUpload.files.length) {
          alert('Por favor, selecione um arquivo primeiro.');
          return;
        }

        // Mostrar progresso
        progressoContainer.style.display = 'block';
        progressoBarra.style.width = '0%';
        progressoTexto.textContent = '0%';
        statusMessage.textContent = 'Iniciando processamento...';
        
        // Simular progresso (substituir por progresso real em produção)
        let progresso = 0;
        const intervalo = setInterval(() => {
          progresso += 1;
          
          if (progresso >= 100) {
            clearInterval(intervalo);
            progressoTexto.textContent = '100%';
            progressoBarra.style.width = '100%';
            statusMessage.innerHTML = '<i class="fas fa-check-circle success"></i> Processamento concluído com sucesso!';
            
            // Submeter o formulário após pequeno delay
            setTimeout(() => {
              form.submit();
            }, 1000);
          } else {
            progressoBarra.style.width = progresso + '%';
            progressoTexto.textContent = progresso + '%';
            
            // Atualizar mensagens de status
            if (progresso < 30) {
              statusMessage.textContent = 'Lendo arquivo e validando dados...';
            } else if (progresso < 60) {
              statusMessage.textContent = 'Aplicando transformações nos dados...';
            } else if (progresso < 90) {
              statusMessage.textContent = 'Otimizando e preparando para download...';
            }
          }
        }, 30);
      });
    });
  </script>
</body>
</html>
